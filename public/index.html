<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <script type="text/javascript" src="d3.js"></script>
  <link rel="stylesheet" href="styling.css">
  <style type="text/css">
  </style>
  <title>Redneck Inc.</title>

      <!-- div hvor grafen finder sted -->
      <div id="overskriften">Rednecks Inc.</div>
      <div id="kortet"></div>
      <div id="continent"></div>
      <div id="min_datavis"></div>
      
</head>

<body>
  
  <script type="text/javascript">

    const w = 1200;
    const h = 620;

  // Lav SVG element til kortet
  const svg1 = d3.select("#kortet")
    .append("svg")
    .attr("width", w)
    .attr("height", h)

  // Position på kortet
  d3.select("#kortet")
    .attr("align", "center");

  // Lav din egen visualsering med data her!
    
  // Hent GeoJSON
  d3.json("./continents.json").then(function (json) {
    console.log(json);
  
  // Lav en mercator projection, fit ind i w og h
  const projection = d3.geoMercator().fitSize([w, h], json);
      
  // Lav en path ud fra projektion
  const path = d3.geoPath(projection);
      
  // Mus over effekt function
  let mouseOver1 = function(d){
    d3.selectAll(".continent")
      .transition()
      .duration(0)
      .style("opacity", 1)
    d3.select(this)
      .transition()
      .duration(0)
      .style("opacity", 1.5)
      .style("fill", "grey")
      .style("stroke", "black")
      .style("stroke-width", 5)
      };
      
  // Mus flyttes effekt function
  let mouseLeave1 = function(d){
    d3.selectAll(".continent")
      .transition()
      .duration(0)
      .style("opacity", 1)
      d3.select(this)
      .transition()
      .duration(0)
      .style("fill", "silver")
      .style("stroke", "black")
      .style("stroke-width", 0.15)
      };

  // Mus klik vælger data
  let mouseClick1 = function(d, g){
      update (g.properties.continent)
      console.log(d, g)
  }

  // Tegn path med SVG. Path data indsættes som 'd'-attribut
  // Tegner kontinenter
   svg1.selectAll("path")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr("stroke", function(d){
        return "black";
        })
      .attr("stroke-width", 0.05)
      .attr("fill", function(d){
        return "silver";
        })
      .attr("class", function(g){return "continent"})
      .on("mouseover", mouseOver1 )
      .on("mouseleave", mouseLeave1 )
      .on("click", mouseClick1)
      });

    // Angiver dimensioner og kanterne på grafen
    const margin = {top: 80, right: 0, bottom: 90, left: 40},
      width = 415 - margin.left - margin.right,
      height = 550 - margin.top - margin.bottom;
      const barPadding = 1;

// Overskrift med kontinent navn
const svg5 = d3.select("#continent")
  .append("svg")
    .attr("width", w)
    .attr("height", h - 570)

/*
let kontinentNavn = "continent";
  if (properties.continent === 1){
    kontinentNavn = "Africa"
  };
*/

      //Heatmap diagram
  // appender svg objektet til body på siden
    const svg2 = d3.select("#min_datavis")
      .append("svg")
         .attr("width", width + margin.left + margin.right)
         .attr("height", height + margin.top + margin.bottom)
      .append("g")
         .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

// Barchart diagram
// append the svg object to the body of the page
var svg4 = d3.select("#min_datavis")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");
        
// Lollipop diagram
// append the svg object to the body of the page
var svg3 = d3.select("#min_datavis")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Denne query kører op imod API'en som findes i 'main.js'.
// Denne HTML skal derfor åbnes igennem serveren for at virke.
function update(selectedVar) {
  d3.json(`/api/data${selectedVar}`, {
    method: "POST", 
  }).then(function(response) {
    const data = response.data; // Hent data ud af response
    console.log("response", data);



// Update data afdeling
// Update text heatmap
let nyData = `/api/data${selectedVar}`;
let updateDia21 = svg2.selectAll("text")
    .data(nyData);
updateDia21.enter()
    .append("text")
.merge(updateDia21)
updateDia21.exit()
    .remove();

// Update rect heatmap
let updateDia22 = svg2.selectAll("rect")
    .data(nyData);
updateDia22.enter()
    .append("rect")
.merge(updateDia22)
updateDia22.exit()
    .remove();

// Update text barchart
let updateDia41 = svg4.selectAll("text")
    .data(nyData);
updateDia41.enter()
    .append("text")
.merge(updateDia41)
updateDia41.exit()
    .remove();

// Update rect barchart
let updateDia42 = svg4.selectAll("rect")
    .data(nyData);
updateDia42.enter()
    .append("rect")
.merge(updateDia42)
updateDia42.exit()
    .remove();

// Update lollipop afdeling
// Update Lollipop text
let updateDia31 = svg3.selectAll("text")
    .data(nyData);
updateDia31.enter()
    .append("text")
.merge(updateDia31)
updateDia31.exit()
    .remove();

// Update Lollipop line
let updateDia32 = svg3.selectAll("line")
    .data(nyData);
updateDia32.enter()
    .append("line")
.merge(updateDia32)
updateDia32.exit()
    .remove();

// Update Lollipop circle
let updateDia33 = svg3.selectAll("circle")
    .data(nyData);
updateDia33.enter()
    .append("circle")
.merge(updateDia33)
updateDia33.exit()
    .remove();

// Overskrift til diagrammer (kontinent)
svg5.select("#continent")
  .data(data)
  .enter()
  .append("text")
  .attr("align", "center");

// Heatmap afdeling
// Array for heatmap y-akse
let heatmapArrayX = [];

// Byg X skalaer og akse
const x = d3.scaleBand()
  .range([0, width])
  .domain(data.map(function(d) {return d.country_name}))
  .padding(0.10);
svg2.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x).tickSize(0))
  .selectAll("text")
  .attr("transform", "translate(-10,0)rotate(-45)")
  .style("text-anchor", "end")
  .select(".domain").remove();

// Byg Y skalaer og akse
const y = d3.scaleBand()
  .range([height, 0])
  .domain(heatmapArrayX)
  .padding(0.05)
svg2.append("g")
  .style("font-size", 15)
  .call(d3.axisLeft(y).tickSize(0))
  .select(".domain").remove()

    // Byg farveskalaen
    const mineFarver = d3.scaleSequential()
      .interpolator(d3.interpolateInferno)
      .domain([1,50])

    // Lav tooltippet
    const tooltip = d3.select("#min_datavis")
      .data(data)
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "darkgrey")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "5px")
      .style("padding", "5px")

    // 3 mus funktioner der ændrer tooltippet når du holder over / bevæger / forlader en celle
    const mouseover = function(d) {
      tooltip
        .style ("opacity", 1)
      d3.select(this)
        .style("stroke", "black")
        .style("opacity", 1)
    }

    const mousemove = function(d) {
      tooltip
        .data(data)
        .html("Country Name : " + d.country_name)
    }
    
    const mouseleave = function(d) {
      tooltip
        .style("opacity", 0)
      d3.select(this)
        .style("stroke", "none")
        .style("opacity", 0.8)
    }

    // Tilføj firkanter
    svg2.selectAll()
      .data(data)
      .enter()
      .append("rect")
        .attr("x", function(d) {return x(d.country_name) })
        .attr("rx", 4)  
        .attr("ry", 4)
        .attr("width", x.bandwidth() )
        .attr("height", y.bandwidth() + 19 )
        .style("fill", function(d) {return mineFarver(d.annual_temperature)} )
        .style("stroke-width", 4)
        .style("stroke", "none")
        .style("opacity", 0.8)
      .on("mouseover", mouseover)
      .on("mousemove", mousemove)
      .on("mouseleave", mouseleave)

    // Tilføjer en titel til grafen
    svg2.append("text")
        .attr("x", -10)
        .attr("y", -40)
        .attr("text-anchor", "left")
        .style("font-size", "12px")
        .text("Heatmap");

    // Tilføjer en beskrivelse til titlen
    svg2.append("text")
        .attr("x", -10)
        .attr("y", -20)
        .attr("text-anchor", "left")
        .style("font-size", "6px")
        .style("fill", "grey")
        .style("font-family", "cursive")
        .style("max-width", 400)
        .text("This chart gives a quick and precise overview of the average temperature pr. country of selected continent");

// Array for lollipop x-akse

// Dimensionerne for grafen er anvendt fra heatmap

// X axis
var xl = d3.scaleBand()
.range([ 0, width ])
.domain(data.map(function(d) { return d.country_name}))
.padding(1);
svg3.append("g")
.attr("transform", "translate(0," + height + ")")
.call(d3.axisBottom(xl))
.selectAll("text")
  .attr("transform", "translate(-10,0)rotate(-45)")
  .style("text-anchor", "end");

// Add Y axis
var yl = d3.scaleLinear()
.domain([0, 300])
.range([ height, 0]);
svg3.append("g")
.call(d3.axisLeft(yl));

// Lines
svg3.selectAll("myline")
.data(data)
.enter()
.append("line")
  .attr("x1", function(d) { return xl(d.country_name); })
  .attr("x2", function(d) { return xl(d.country_name); })
  .attr("y1", function(d) { return yl(((d.liver_cirrhosis_death_rates_male)+(d.liver_cirrhosis_death_rates_female))); })
  .attr("y2", yl(0))
  .attr("stroke", "grey")

// Circles
svg3.selectAll("mycircle")
.data(data)
.enter()
.append("circle")
  .attr("cx", function(d) { return xl(d.country_name); })
  .attr("cy", function(d) { return yl(((d.liver_cirrhosis_death_rates_male)+(d.liver_cirrhosis_death_rates_female))); })
  .attr("r", "4")
  .style("fill", "#69b3a2")
  .attr("stroke", "black")

// Tilføjer en titel til Lollipop chart
svg3.append("text")
    .attr("x", -10)
    .attr("y", -40)
    .attr("text-anchor", "right")
    .style("font-size", "12px")
    .text("Lollipop Chart");

// Tilføjer en beskrivelse til titlen
svg3.append("text")
    .attr("x", -10)
    .attr("y", -20)
    .attr("text-anchor", "right")
    .style("font-size", "6px")
    .style("fill", "grey")
    .style("font-family", "cursive")
    .style("max-width", 400)
    .text ("This chart gives a quick and precise overview of liver cirrhosis cases pr. 100.000");

// Barchart Afdeling
// X axis
var xa = d3.scaleBand()
    .range([ 0, width ])
    .domain(data.map(function(d) { return d.country_name}))
    .padding(0.2);
svg4.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(xa))
    .selectAll("text")
    .attr("transform", "translate(-10,0)rotate(-45)")
    .style("text-anchor", "end");

// Add Y axis
var ya = d3.scaleLinear()
    .domain([0, 30])
    .range([ height, 0]);
    svg4.append("g")
    .call(d3.axisLeft(ya));

//opret Bars
svg4.selectAll("mybar")
    .data(data)
    .enter()
    .append("rect")
    .attr("x", function(d) {return xa(d.country_name); })
    .attr("y", function(d) {return ya(d.alcohol_consumption_male);})
    .attr("width", xa.bandwidth() )
    .attr("height", function(d) {return height - ya(d.alcohol_consumption_male); })
    .attr("fill", "#800080");

// Tilføjer en titel til Barchart
svg4.append("text")
    .attr("x", -10)
    .attr("y", -40)
    .attr("text-anchor", "rigth")
    .style("font-size", "12px")
    .text("Bar Chart")

svg4.append("text")
    .attr("x", -10)
    .attr("y", -20)
    .attr("text-anchor", "right")
    .style("font-size", "6px")
    .style("fill", "grey")
    .style("font-family", "cursive")
    .style("max-width", 400)
    .text ("This chart gives a quick and precise over of average alcohol consumption pr. litre pr. capita")
})
}
  </script>
</body>
</html>